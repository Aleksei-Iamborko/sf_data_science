---
title: "HW_4_Iamborko"
author: "Aleksei Iamborko"
date: "2024-04-14"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Задание 1.

1. Сформулируем нулевую и альтернативную гипотезы:
 - Нулевая гипотеза (H0): Среднее артериальное давление пациентов до и после приема нового препарата одинаково.
 - Альтернативная гипотеза (H1): Среднее артериальное давление пациентов после приема нового препарата меньше, чем до его приема.
2. Уровень значимости часто выбирают равным 0.05, что означает, что мы будем рассматривать 5% вероятности ошибки первого рода.
3. Для проверки гипотезы в данном случае подходит одновыборочный t-тест, потому что мы сравниваем средние значения в одной группе до и после вмешательства.

```{r}
library(tidyverse)
library(ggplot2)
library(multcomp)
library(car)

# Задаем seed для воспроизводимости результатов
set.seed(123)

# Задаем размер выборки
sample_size <- 30

# Генерируем выборку для среднего артериального давления до приема нового препарата
before_treatment <- rnorm(sample_size, mean = 162.5, sd = 4.8)  # Среднее 162.5, стандартное отклонение 4.8

# Генерируем выборку для среднего артериального давления после приема нового препарата
after_treatment <- rnorm(sample_size, mean = 153.7, sd = 5.1)  # Среднее 153.7, стандартное отклонение 5.1

# Выводим выборку
print(before_treatment)
print(after_treatment)

# Установим критический уровень значимости
alpha <- 0.05

# Проверка на нормальность: критерий Шапиро-Уилка
shapiro_test_before <- shapiro.test(before_treatment)
shapiro_test_after <- shapiro.test(after_treatment)

# Вывод результатов теста Шапиро-Уилка
print("Тест на нормальность для выборки до приема препарата:")
print(shapiro_test_before)
if (shapiro_test_before$p.value > alpha) {
  print("Результат: Нет оснований отвергнуть нулевую гипотезу (выборка до приема препарата имеет нормальное распределение)")
} else {
  print("Результат: Основания отвергнуть нулевую гипотезу (выборка до приема препарата не имеет нормального распределения)")
}

print("Тест на нормальность для выборки после приема препарата:")
print(shapiro_test_after)
if (shapiro_test_after$p.value > alpha) {
  print("Результат: Нет оснований отвергнуть нулевую гипотезу (выборка после приема препарата имеет нормальное распределение)")
} else {
  print("Результат: Основания отвергнуть нулевую гипотезу (выборка после приема препарата не имеет нормального распределения)")
}
```
## Вывод:
Обе выборки со значениями уровня давления до и после приема препарата имеют нормальное распределение (хотя это было известно изначально, так как мы сгенерировали выборки с нормальным распределение), поэтому применим для сравнения выборок t-test для зависимых выборок (так как анализируем одних и тех же пациентов до и после приема препарата)
```{r}
# Выбираем t-тест  для проверки гипотезы, так как мы сравниваем средние значения одной выборки до и после приема препарата.

# Вычисляем t-статистику и p-значение
t_test_result <- t.test(before_treatment, after_treatment, paired = TRUE)$statistic
p_value <- t.test(before_treatment, after_treatment, paired = TRUE)$p.value

# Определяем критическое значение статистики для уровня значимости alpha
critical_value <- qt(1 - alpha/2, df = sample_size - 1)

# Выводим результаты
cat("Статистика t:", t_test_result, "\n")
cat("p-значение:", p_value, "\n")
cat("Критическое значение t:", critical_value, "\n")

if (abs(t_test_result) > critical_value) {
  cat("Результат статистически значимый на уровне значимости", alpha, "\n")
} else {
  cat("Результат не является статистически значимым на уровне значимости", alpha, "\n")
}
```
## Вывод: 
проведен t-тест для сравнения среднего артериального давления до и после приема нового препарата. Значение статистики t превышает критическое значение, поэтому отвергаем нулевую гипотезу о равенстве средних значений до и после лечения. Результат теста указывает на статистическую значимость эффекта лечения на уровне значимости 0.05. Среднее артериальное давление пациентов после приема нового препарата меньше, чем до его приема.

# Задание 2.

1. Формулировка гипотез: 
- Нулевая гипотеза: вероятность заболеть раком легких одинакова у курящих и некурящих людей.
- Альтернативная гипотеза: есть значимая разница в вероятности заболевания раком легких между курящими и некурящими людьми.
2. Уровень значимости: для нашего тестирования возьмем 0.05.
3. Выбор статистического теста:
Учитывая, что у нас есть бинарные переменные (курение: курящий/некурящий, заболевание: рак/нет рака) и мы хотим проверить зависимость между этими переменными, подходящим тестом будет Хи-квадрат тест на независимость. Для него нет требований по нормальномсти распределения, поэтому проверку проводить не будем.
4. Генерация данных и проведение теста: для каждой выборки сгенерируем данные о курении, учитывая вероятности заболевания раком легких. Затем проведем Хи-квадрат тест на независимость.
5. Определение наблюдаемого значения статистики и критического значения:
 - Наблюдаемая статистика: значение статистики Хи-квадрат покажет, насколько наши данные соответствуют нулевой гипотезе.
- Критическое значение: значение статистики, при котором мы отвергаем нулевую гипотезу на заданном уровне значимости.
6. Оценка статистической значимости: будем оценивать статистическую значимость на основе p-значения, полученного при проведении теста, и сравнивать его с приятым уровнем значимости.

Сгенерируем данные для двух случаев: для выборки с размером sample_size1 = 100 и для выборки с размером sample_size2 = 30. Предположим, что отношение числа курящих к некурящим в каждой выборке составляет 1:1.
```{r}
# Генерация данных для выборки размером 100
smokers <- rep(c("Smoker", "Non-smoker"), each = 50)
lung_cancer <- ifelse(smokers == "Smoker", rbinom(50, 1, 0.8), rbinom(50, 1, 0.2))

# Создание датафрейма
data_sample1 <- data.frame(smokers, lung_cancer)

# Печать первых строк датафрейма
print(head(data_sample1))

# Генерация данных для выборки размером 30
smokers <- rep(c("Smoker", "Non-smoker"), each = 15)
lung_cancer <- ifelse(smokers == "Smoker", rbinom(15, 1, 0.8), rbinom(15, 1, 0.2))

# Создание датафрейма
data_sample2 <- data.frame(smokers, lung_cancer)

# Печать первых строк датафрейма
print(head(data_sample2))

# Составление таблиц сопряженности для двух выборок
contingency_table <- table(data_sample1$smokers, data_sample1$lung_cancer)
contingency_table <- rbind(contingency_table, table(data_sample2$smokers, data_sample2$lung_cancer))

# Проведение Хи-квадрат теста на независимость
result <- chisq.test(contingency_table)

# Результат теста
print("\nТаблица сопряженности:")
print(contingency_table)
print("\nРезультаты Хи-квадрат теста:")
print(result)
```
## Вывод:
результаты Хи-квадрат теста на независимость указывают на то, что p-value ниже принятого уровня значимости 0.05. Таким образом, мы можем однозначно отвергнуть нулевую гипотезу о независимости между курением и развитием рака легких. На основании этих результатов можно сделать вывод, что существует статистически значимая связь между курением и развитием рака легких в рассматриваемых выборках. То есть, вероятность различий в распределении переменных "курение" и "развитие рака легких" случайно мала, что подтверждает значимость связи между этими двумя факторами.

# Задание 3.

 1. Гипотезы:
 - Нулевая гипотеза (H0): Применение нового метода лечения синдрома раздраженного кишечника не оказывает значимого влияния на уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.
 - Альтернативная гипотеза (H1): Применение нового метода лечения синдрома раздраженного кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.
 2. Уровень значимости:
 - Для определения статистической значимости используем уровень значимости 0.05
 3. Проверим выборки на соотвествие нормальному распределению с помощью критерия Шапиро-Уилка.
 4. Выбор статистического теста:
- В случае если выборки имеют нормальное распределение переменных болевых симптомов и однородные дисперсии, то для проверки различий в уровне болевых симптомов между двумя группами (новый метод лечения vs. диетотерапия) можно использовать двухвыборочный t-тест для независимых выборок. Если выборки имеют распределение, отличающееся от нормального, то для проверки различий в уровне болевых симптомов между двумя группами будем использовать непараметрический тест Манна-Уитни.
 5. Наблюдаемое и критическое значение статистики:
 - После проведения выбранного теста получим наблюдаемое значение критерия. Опираясь на это значение, сравним его с критическим значением критерия для определенной степени свободы и уровня значимости.
 6. Оценка статистической значимости:
- Если наблюдаемое значение выбранного критерия попадает в критическую область (превысит критическое значение), то мы можем отклонить нулевую гипотезу и принять альтернативную, что говорит о наличии статистически значимого различия между эффективностью нового лечения и диетотерапией по уровню болевых симптомов. После проведения соответствующих расчетов и тестирования гипотез вы сможете сделать вывод о статистической значимости эффективности нового метода лечения синдрома раздраженного кишечника.

Создадим данные для двух групп: группа 1, которая проходила лечение диетотерапией, и группа 2, которая проходила лечение новым методом. Уровень болевых симптомов будем оценим от 0 до 10, где значение 0 - отсутствие болевых ощущений, а значение 10 - сильные боли.
```{r}
# Генерируем данные для группы 1 (диетотерапия)
n_group1 <- 30  # размер выборки для группы 1
pain_levels_group1 <- round(runif(n_group1, min = 1, max = 6), digits = 0)

# Повторяем каждое значение для группы 1
repeated_pain_levels_group1 <- rep(pain_levels_group1, each = 3)

# Генерируем данные для группы 2 (новый метод)
n_group2 <- 30  # размер выборки для группы 2
pain_levels_group2 <- round(runif(n_group2, min = 0, max = 4), digits = 0)

# Повторяем каждое значение для группы 2
repeated_pain_levels_group2 <- rep(pain_levels_group2, each = 4)

# Выводим сгенерированные данные
print(repeated_pain_levels_group1)
print(repeated_pain_levels_group2)

# Проверка на нормальность: критерий Шапиро-Уилка
shapiro_test_before <- shapiro.test(repeated_pain_levels_group1)
shapiro_test_after <- shapiro.test(repeated_pain_levels_group2)

# Вывод результатов теста Шапиро-Уилка
print("Тест на нормальность для выборки group1:")
print(shapiro_test_before)
if (shapiro_test_before$p.value > alpha) {
  print("Результат: Нет оснований отвергнуть нулевую гипотезу (выборка group1 имеет нормальное распределение)")
} else {
  print("Результат: Основания отвергнуть нулевую гипотезу (выборка group1 не имеет нормального распределения)")
}

print("Тест на нормальность для выборки group2:")
print(shapiro_test_after)
if (shapiro_test_after$p.value > alpha) {
  print("Результат: Нет оснований отвергнуть нулевую гипотезу (выборка group2 имеет нормальное распределение)")
} else {
  print("Результат: Основания отвергнуть нулевую гипотезу (выборка group2 не имеет нормального распределения)")
}

# Обе выборки (группа 1, которая проходила лечение диетотерапией, и группа 2, которая проходила лечение новым методом) имеют отличное от нормального распределение, поэтому применим для сравнения выборок тест Манна-Уитни.

# Применяем тест Манна-Уитни
mann_whit_result <- wilcox.test(repeated_pain_levels_group1, repeated_pain_levels_group2, alternative = "two.sided")

# Выводим результаты теста
if(mann_whit_result$p.value < 0.05) {
  cat("Разница между уровнями боли в двух группах является статистически значимой (p < 0.05).\n")
} else {
  cat("Нет статистически значимой разницы между уровнями боли в двух группах (p >= 0.05).\n")
}

# Выводим результат теста Манна-Уитни
print(mann_whit_result)
```
## Вывод: 
уровень значимости p-value меньше 2.2e-16, что гораздо ниже стандартного уровня значимости 0.05. Это означает, что разница между уровнями боли в двух группах является статистически значимой.Величина критерия показывает, что средние значения уровня боли в двух группах значительно различаются. Исходя из этих результатов, можно сделать вывод о статистически значимой разнице между уровнем боли в двух группах.Применение нового метода лечения синдрома раздраженного кишечника значимо меняет уровень болевых симптомов по сравнению с группой, прошедшей лечение диетотерапией.

# Задание 4.
```{r}
# Создание датасета с информацией о размерах опухолей и противоопухолевых препаратах
tumor <- tibble(
  therapy = c(rep("0", 10), rep("A", 10), rep("B", 10)),
  value = c(rep(3213, 10), rep(2687, 10), rep(2423, 10))
) %>%
mutate(therapy = factor(therapy, levels = c("0", "A", "B")))
tumor$value <- tumor$value + rnorm(30, 0, 760)

# Построение графика "ящиков с усами"
ggplot(tumor, aes(x = therapy, y = value, fill = therapy)) +
  geom_boxplot() +
  labs(title = "Размеры опухолей по препаратам",
       x = "Препарат",
       y = "Размер опухоли") +
  scale_fill_manual(values = c("0" = "grey", "A" = "blue", "B" = "red")) 

# Проверка нормальности выборки "0"
shapiro_test_0 <- shapiro.test(tumor$value[tumor$therapy == "0"])

print("Тест на нормальность для выборки 0:")
print(shapiro_test_0)
if (shapiro_test_0$p.value > alpha) {
  print("Результат: Нет оснований отвергнуть нулевую гипотезу (выборка 0 имеет нормальное распределение)")
} else {
  print("Результат: Основания отвергнуть нулевую гипотезу (выборка 0 не имеет нормального распределения)")
}

# Проверка нормальности выборки "A"
shapiro_test_A <-shapiro.test(tumor$value[tumor$therapy == "A"])
print("Тест на нормальность для выборки A:")
print(shapiro_test_A)
if (shapiro_test_A$p.value > alpha) {
  print("Результат: Нет оснований отвергнуть нулевую гипотезу (выборка A имеет нормальное распределение)")
} else {
  print("Результат: Основания отвергнуть нулевую гипотезу (выборка A не имеет нормального распределения)")
}

# Проверка нормальности выборки "B"
shapiro_test_B <- shapiro.test(tumor$value[tumor$therapy == "B"])
print("Тест на нормальность для выборки 0:")
print(shapiro_test_B)
if (shapiro_test_B$p.value > alpha) {
  print("Результат: Нет оснований отвергнуть нулевую гипотезу (выборка B имеет нормальное распределение)")
} else {
  print("Результат: Основания отвергнуть нулевую гипотезу (выборка B не имеет нормального распределения)")
} # Значения во всех исследуемых выборках распределены нормально.

# Проверка однородности дисперсий между выборками
leveneTest(value ~ therapy, data = tumor) #p-значение равно 0.4827, что означает, что нет статистически значимых различий в дисперсиях между выборками. Таким образом, на основании этого теста можно считать дисперсии однородными.

# Параметрический однофакторный дисперсионный анализ
anova_result <- aov(value ~ therapy, data = tumor)
anova_summary <- summary(anova_result)
print(anova_summary)

# Попарные сравнения с использованием критерия Тьюки с поправкой  Бенджамини-Хохберга
bh_contrasts <- summary(glht(anova_result, linfct = mcp(therapy = "Tukey")), test = adjusted("BH"))
bh_contrasts
```
## Вывод: 
результаты однофакторного дисперсионного анализа показывают, что между группами с разными противоопухолевыми препаратами существует статистически значимая разница в размерах опухолей (F(2, 27) = 5.428, p = 0.0104). Это означает, что выбранный препарат может оказывать влияние на размер опухоли у мышей. Более детальный анализ с помощью попарных сравнений между группами (0, A, B) с использованием метода Tukey Contrasts показал следующее:
1. Сравнение между группами, принимавшими противоопухолевый препарат A и плацебо 0, не показало статистически значимых различий, так как p-значение (0.15427) больше уровня значимости 0.05.
2. Сравнение между группами, принимавшими противоопухолевый препарат B и плацебо 0, показало статистически значимые различия, так как p-значение (0.00841) меньше уровня значимости 0.05. Это означает, что средние размеры опухолей значимо различаются после применения этого противоопухолевого препарата.
3. Сравнение между группами, принимавшими противоопухолевый препарат B и A, также не показало статистически значимых различий, так как p-значение (0.11918) больше уровня значимости 0.05.
Таким образом, результаты попарных сравнений указывают на статистически значимые различия в эффективности противоопухолевого препарата B по сравнению с приемом плацебо 0, но применение противоопухолевого препарата A в сравнении с плацебо 0 не дает значимого эффекта.Также эффективность препаратов B и A статистически не отличается. Заключаем, что, препарат B оказывает статистически значимое воздействие на размеры опухолей по сравнению с контрольной группой 0, а эффект препарата A статистически не подтвержден. Однако, учитывая отсутсвие различий с воздействием препарата B, препарат А все же имеет тенденцию к некоторому воздействию и в этом случае необходимы дополнительные исследования.