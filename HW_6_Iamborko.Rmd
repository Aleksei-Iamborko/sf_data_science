---
title: "HW_6_Iamborko"
author: "Aleksei Iamborko"
date: "2024-04-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Домашнее задание 6
При выполнении этого домашнего задания вам необходимо посчитать выборки для различных типов точек. Напишите соответствующий код, пользуясь указанными формулами.
```{r}
# Общие условия
# Уровень значимости
alpha <- 0.05
# Значение beta
beta <- 0.2
# Drop-out rate
dropout_rate <- 0.1
```
## Задание 1. Рассчитайте выборку для исследования терапевтической эквивалентности для двухпериодного cross-over дизайна. Из предыдущих исследований известно, что дисперсия составляет 20%, а разница средних составляет −10%. Клиницисты сообщают нам, что клинически значимая разница составляет 25%.
```{r}
# Дисперсия
sigma <- 0.20

# Разница средних значений
epsilon <- -0.10

# Клинически значимая разница
delta <- 0.25

# z-значение для уровня значимости и мощности
z_alpha_2 <- qnorm(1 - alpha/2)
z_beta <- qnorm(power)

# Рассчитаем размер выборки для каждой группы
n <- ((z_alpha_2 + z_beta)^2 * sigma^2) / (2 * (delta - abs(epsilon))^2)

# Учитывая drop-out rate
n <- n / (1 - dropout_rate)

# Рассчитавем общий размер выборки
n_total <- n * 2

# Выводим результат
cat("Размер выборки для каждой группы:", round(n), "\n")
cat("Общий размер выборки (n_total):", round(n_total), "\n")
```

## Задание 2. Рассчитайте выборку для гипотезы non-inferiority для двухвыборочного параллельного дизайна.Пусть клинически значимая разница delta=-0.1, то есть мы ожидаем разницу не меньше 10%, а долю ответов для тестового препарата  p2=0.65, в то время как нам известно из предыдущих исследований, что доля ответов у препарата сравнения составляет p1=0.85. Соотношение групп равно k=1.

```{r}
# Клинически значимая разница
delta <- -0.1

# Доля ответов для тестового препарата
p2 <- 0.65

# Доля ответов для препарата сравнения
p1 <- 0.85

# Соотношение групп
k <- 1

# z-значение для уровня значимости и мощности
z_alpha_2 <- qnorm(1 - alpha/2)
z_beta <- qnorm(power)

# Рассчитываем размер выборки для каждой группы
n <- ((((z_alpha_2 + z_beta)^2) * (p1 * (1 - p1) + p2 * (1 - p2))) / (p1 - p2 - delta)^2) * k

# Учитываем drop-out rate
n_with_dropout <- n / (1 - dropout_rate)

# Округляем в большую сторону
n <- ceiling(n_with_dropout)

# Рассчитаем общий размер выборки
n_total <- n * 2

# Выводим результат
cat("Размер выборки для каждой группы:", round(n), "\n")
cat("Общий размер выборки:", round(n_total), "\n")
```
## Задание 3. Рассчитайте выборку для гипотезы equality для следующего исследования. Мы хотим сравнить новую терапию инфекции, присоединяющейся в больничных условиях у пациентов с ожогами, с золотым стандартом, основываясь на данных, анализируемых с помощью регрессии Кокса.Пусть отношение рисков «золотой стандарт / новая терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов (d = 0.8) могут столкнуться с этим заболеванием. Соотношения групп терапии равны (p1=p2=0.5)
```{r}
# Отношение рисков
HR <- 2

# Доля пациентов, подверженных заболеванию
d <- 0.8

# Соотношение групп
p1 <- 0.5
p2 <- 0.5

# z-значение для уровня значимости и мощности
n <- ((z_alpha_2 + z_beta)^2) / ((log(HR)^2) * p1 * p2 * d)

# Учитываем drop-out rate
n <- n / (1 - dropout_rate)

# Рассчитываем общий размер выборки
n_total <- n * 2

# Выводим результат
cat("Размер выборки для каждой группы:", round(n), "\n")
cat("Общий размер выборки:", round(n_total), "\n")
```

